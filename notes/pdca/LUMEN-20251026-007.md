# LUMEN-20251026-007 - Undo/Redo i Autosort Morfogenezy

## Plan
- **Cel**: Zapewnić użytkownikowi możliwość cofania i ponawiania operacji na płótnie oraz wstępnie rozwiązywać kolizje komórek (`autosort`) zgodnie z guard rails Echo.
- **Zakres**: kolejka zdarzeń undo/redo dla dodawania, przesuwania, zmiany promienia i usuwania komórek; heurystyka autosort przenosząca kolidujące komórki na sąsiednie heksy; aktualizacja UI z kontrolkami cofania/przywracania.
- **Zależności**: aktualne guard rails (`docs/ux/morphogeneza-ux-research.md`), logika ViewModelu i repozytorium form, checklisty Kai/Nodusa.

## Do
- Zdefiniować strukturę historii w `MorphogenesisViewModel` (stack undo/redo + limit kroków).
- Zaimplementować rejestrowanie operacji (add/remove/move/radius) oraz akcje `undo()` / `redo()`.
- Dodać heurystykę autosort (przy kolizji przesunąć komórkę na najbliższy wolny hex).
- Uzupełnić UI o przyciski cofania/przywracania i komunikaty kolizji po autosorcie.
- Testy: `./gradlew test` po każdej większej zmianie + `./gradlew connectedDebugAndroidTest` na końcu.

## Check
- Jednostkowe: scenariusze undo/redo oraz autosort w `MorphogenesisViewModelTest`.
- Instrumentacja Compose: weryfikacja przycisków cofania/przywracania i poprawnego stanu płótna.
- Manualnie: cofanie/ponawianie sekwencji drag/tap działa w oczekiwany sposób, autosort nie wychodzi poza boundary.

## Act
- Jeśli heurystyka autosort będzie za agresywna – rozważyć tryb podpowiedzi zamiast natychmiastowego przenoszenia.
- Po zakończeniu zaktualizować guard rails Echo, plan testów Kai i checklisty Nodus.
- Zaproponować kolejne usprawnienia (np. zapis snapshotów historii do repo).***
